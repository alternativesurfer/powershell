##########################################################
##########################################################
### This Script was created on 2/18/2021 by Ian Hart   ###
###----------------------------------------------------###
### The purpose of this script is to create the PCG    ###
### default Anti-Malware policy.  It lists the existing###          
### policies. It will then breakdown the default policy###          
### for review.  If there is no other policy created   ###          
### it will then create the PCG Default which will take###          
### precedence over the current default policy.        ###          
##########################################################          

#Imports the ExchangeOnline Module
Import-Module ExchangeOnlineManagement
#Connect to ExchangeOnline
Connect-ExchangeOnline

Write-Host "Here are the current Anti-Malware Policies" -Foreground Green
Get-MalwareFilterPolicy | Out-Host

$Answer = Read-Host "Would you Like to Change the Default Policy to the Recommended Standard? - Y(Yes) or N(No)"


If($Answer -contains "y")
    {
    #Sets the Default Policy Variable to Manipulate that Specific Policy
    $MWFilter = Get-MalwareFilterPolicy Default

    #Checks to see if the File Filter is on and sets it on
    If($MWFilter.EnableFileFilter -eq $False)
        {
        Set-MalwareFilterPolicy Default -EnableFileFilter $True
        }

    #Checks for Internal Sender Notifications
    If($MWFilter.EnableInternalSenderNotifications -eq $False)
        {
        Set-MalwareFilterPolicy Default -EnableInternalSenderNotifications $True
        }

    #Checks for admin notifications - then sets it to our alert channel in Teams
    If($MWFilter.EnableInternalSenderAdminNotifications -eq $False)
        {
        Set-MalwareFilterPolicy Default -EnableInternalSenderAdminNotifications $True
        Set-MalwareFilterPolicy Default -InternalSenderAdminAddress "pcgo365@pcgit.net"
        }

    #Creates the Action of the Malware Filter
    If($MWFilter.Action -eq "DeleteMessage")
        {
        Set-MalwareFilterPolicy Default -Action "DeleteAttachmentAndUseDefaultAlertText"
        }

    #Changes the Description if Blank
    If(!$MWFilter.AdminDisplayName)
        {
        Set-MalwareFilterPolicy Default -AdminDisplayName "PCG Default AntiMalware - created by a script"
        }

    #Spits out the new current Policy
    $MWFilter = Get-MalwareFilterPolicy Default
    $MWFilter | FL
    Write-Host "You're Current Default Policy is above" -ForegroundColor Green
    }
 Else
    {
    Write-Host "Exiting Script with no changes made" -ForegroundColor Red
    }
    